<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jack Williams and Quinn Asena">
<meta name="dcterms.date" content="2022-09-29">

<title>Lab 3: Age-Depth Models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="03-age-depth-modelling_files/libs/clipboard/clipboard.min.js"></script>
<script src="03-age-depth-modelling_files/libs/quarto-html/quarto.js"></script>
<script src="03-age-depth-modelling_files/libs/quarto-html/popper.min.js"></script>
<script src="03-age-depth-modelling_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="03-age-depth-modelling_files/libs/quarto-html/anchor.min.js"></script>
<link href="03-age-depth-modelling_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="03-age-depth-modelling_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="03-age-depth-modelling_files/libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="03-age-depth-modelling_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="03-age-depth-modelling_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="03-age-depth-modelling_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="03-age-depth-modelling_files/libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#before-the-lab" id="toc-before-the-lab" class="nav-link active" data-scroll-target="#before-the-lab">Before the lab</a></li>
  <li><a href="#part-1-background" id="toc-part-1-background" class="nav-link" data-scroll-target="#part-1-background">Part 1: Background</a>
  <ul class="collapse">
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#calibration-of-radiocarbon-dates" id="toc-calibration-of-radiocarbon-dates" class="nav-link" data-scroll-target="#calibration-of-radiocarbon-dates">Calibration of Radiocarbon Dates</a></li>
  <li><a href="#types-of-age-depth-models" id="toc-types-of-age-depth-models" class="nav-link" data-scroll-target="#types-of-age-depth-models">Types of Age-Depth Models</a></li>
  </ul></li>
  <li><a href="#part-2-exercises" id="toc-part-2-exercises" class="nav-link" data-scroll-target="#part-2-exercises">Part 2: Exercises</a>
  <ul class="collapse">
  <li><a href="#exercise-1-calibration" id="toc-exercise-1-calibration" class="nav-link" data-scroll-target="#exercise-1-calibration">Exercise 1: Calibration</a></li>
  <li><a href="#exercise-2-classical-age-depth-models" id="toc-exercise-2-classical-age-depth-models" class="nav-link" data-scroll-target="#exercise-2-classical-age-depth-models">Exercise 2: Classical age-depth models</a></li>
  <li><a href="#exercise-3-bayesian-age-depth-models" id="toc-exercise-3-bayesian-age-depth-models" class="nav-link" data-scroll-target="#exercise-3-bayesian-age-depth-models">Exercise 3: Bayesian age-depth models</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Lab 3: Age-Depth Models</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jack Williams and Quinn Asena </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 29, 2022</p>
    </div>
  </div>
    
  </div>
  

</header>

<section id="before-the-lab" class="level1">
<h1>Before the lab</h1>
<p><strong>Using what you learned from the last lab:</strong></p>
<ol type="1">
<li><p>Create a directory for this lab called <em>03-age-depth-models</em> and two sub-directories inside called <em>data</em> and <em>outputs</em></p></li>
<li><p>Create an R project inside <em>03-age-depth-models</em>, open a new R script, install the packages <em>clam</em> and <em>Bchron</em>, and save your script</p></li>
</ol>
<p><strong>Read these papers:</strong></p>
<ol type="1">
<li><p>Bronk Ramsey, C. (2008) Radiocarbon dating: Revolutions in understanding. Archaeometry 50:249-275. (Read only to p.260.) <em>A good overview of radiocarbon fundamentals and interpretation for a general audience.</em></p></li>
<li><p>Blaauw, M. (2010) Methods and code for ‘classical’ age-modelling of radiocarbon sequences. Quaternary Geochronology 5:512-518. <em>Good overview and code for ‘classic’ age-depth modeling: linear interpolation, regression, polynomial regression, splines, etc.</em></p></li>
</ol>
</section>
<section id="part-1-background" class="level1">
<h1>Part 1: Background</h1>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>A foundational difference between geology and ecology is that, for geologists, time is an unknown variable that must be estimated with uncertainty. In contrast, most ecologists can assume that the temporal coordinates of their observations are known precisely, with zero uncertainty. Fortunately, geochronologists have a wide variety of natural clocks, thanks to the constant decay rates of radioactive isotopes. Each isotope has a unique decay rate, and so each is appropriate for particular timescales.</p>
<p>For the last 50,000 years, radiocarbon (<sup>14</sup>C), with its half-life of 5,730 years, is by far the most common form of radiometric dating. (Beyond 10 half-lives, so much of a radioactive substance has decayed away that it becomes immeasurable.) Radiocarbon is the mainstay of Quaternary dating and archaeology.</p>
<p>In Quaternary paleoecology, radiocarbon dating is expensive – a single sample typically costs $300 to $500 – so usually a given lake-sediment record will have only a scattering (ca. 5 to 30) of radiocarbon dates and other age controls. Other kinds of age controls include volcanic ash layers (tephras), <sup>210</sup>Pb (half-life: 22.6 yrs), optically stimulated luminescence (OSL) dates, historic events such as the rise in <em>Ambrosia</em> pollen abundances associated with EuroAmerican land clearance, etc. An age-depth model must be constructed to estimate the age of sediments not directly associated with an age control. In multi-site data syntheses, the number of age controls, their precision, and their likely accuracy are all fundamental indicators of data quality (e.g.&nbsp;<a href="https://www.sciencedirect.com/science/article/pii/S0277379111001193">Blois et al.&nbsp;2011</a>, <a href="https://www.science.org/doi/pdf/10.1126/science.abg1685">Mottl et al.&nbsp;2021</a>).</p>
<p>To estimate ages for depths lacking radiocarbon date, an age-depth model is required. Age-depth models are fitted to the available age controls (age estimates with uncertainty for individual depths) and provide estimates of age as a function of depth, for all depths and ages within the temporal bounds of the model.</p>
<p>Here we will gain practice in working with age-depth models of various kinds, using several standard R packages (<code>clam</code>, <code>Bchron</code>, and see also <code>bacon</code>), and assessing their age estimates and uncertainty. We’ll begin with a bit of practice in calibrating radiocarbon years to calendar years and comparing the resulting age estimates from different calibration curves.</p>
</section>
<section id="calibration-of-radiocarbon-dates" class="level2">
<h2 class="anchored" data-anchor-id="calibration-of-radiocarbon-dates">Calibration of Radiocarbon Dates</h2>
<p>A complication in radiocarbon dating is that the initial calculation of a radiocarbon age assumes, by convention, that the amount of radiocarbon in the atmosphere is constant over time. See Bronk Ramsey (2008) for a good overview of <sup>14</sup>C dating. This assumption is untrue, so all radiocarbon age estimates must be post-hoc calibrated using a calibration curve that is based on compiling radiocarbon dates of materials that have precise independent age estimates (e.g.&nbsp;tree rings, corals). The IntCal series (IntCal04, IntCal09, IntCal13, IntCal20) is the community standard for calibrating radiocarbon dates to age estimates in calendar years (e.g.&nbsp;<a href="https://www.cambridge.org/core/journals/radiocarbon/article/intcal20-northern-hemisphere-radiocarbon-age-calibration-curve-055-cal-kbp/83257B63DC3AF9CFA6243F59D7503EFF">Reimer et al., 2020</a>). The conversion from radiocarbon to calendar years usually further increases the uncertainty of age estimates.</p>
<p>Yet another complication in radiocarbon dating is that different calibration curves need to be used for the Northern vs.&nbsp;Southern Hemisphere and for the atmosphere vs.&nbsp;oceans, due to different residence times of <sup>14</sup>C in these different reservoirs. For example, atmospheric radiocarbon that diffuses into the surface oceans usually will reside for centuries before phytoplankton biologically fix it through photosynthesis, which will lead marine <sup>14</sup>C to be depleted (and ‘too old’) relative to atmospheric <sup>14</sup>C. Use the wrong calibration curve and your age estimate will be inaccurate!</p>
</section>
<section id="types-of-age-depth-models" class="level2">
<h2 class="anchored" data-anchor-id="types-of-age-depth-models">Types of Age-Depth Models</h2>
<p>Different kinds of age-depth models exist, each with their own underlying assumptions and behavior. In the list below, #1-4 are classical or traditional forms of age-depth models, but Bayesian models (<em>Bchron</em>, <em>bacon</em>) are now the norm. For learning purposes, we’ll begin with the classics.</p>
<ol type="1">
<li><p><strong>Linear interpolation</strong>, a.k.a. ‘connect the dots,’ in which straight lines are drawn between each depth-adjacent pair of age controls.</p></li>
<li><p><strong>Linear regression</strong> (<span class="math inline">\(y=b0~ + b1x\)</span>; <span class="math inline">\(y=\)</span>time and <span class="math inline">\(x=\)</span>depth; <span class="math inline">\(b0\)</span> and <span class="math inline">\(b1\)</span> are constants), in which a single straight line is fitted through the entire set of age controls. In ordinary linear regression (OLS), the chosen line will minimize the y-dimension distances of individual points to the line. Standard OLS assumes that all observations are normally distributed, which is a poor assumption for calibrated radiocarbon dates.</p></li>
<li><p><strong>Polynomials</strong>, also fitted to the entire set of age controls (<span class="math inline">\(y= b0 + b1x + b2x^2 + b3x^3 + …bnx^n\)</span>), are an extension of linear regression, with additional terms for <span class="math inline">\(x^2\)</span>, <span class="math inline">\(x^3\)</span>, etc. Some arbitrary maximum n is chosen, usually in the range of 3 to 5. These are called ‘third-order polynomials,’ ‘fifth-order polynomials,’ etc.</p></li>
<li><p><strong>Splines</strong>, which are a special kind of polynomial function that are locally fitted to subsets of the age controls, and then smoothly interpolated between points. (Several different formulas can be used to generate splines; common forms include cubic, smooth, monotonic, and LOWESS).</p></li>
<li><p><strong>Bayesian age models</strong> (e.g.&nbsp;<code>bacon</code>, <code>bchron</code>, <code>oxcal</code>, etc.). Bayesian models differ in detail, but all combine a statistical representation of prior knowledge with the new data (i.e.&nbsp;the age controls at a site) to build an age-depth model with posterior estimates of age for any given depth. Bayesian models are now widely used because</p>
<ol type="i">
<li>they allow the incorporation of prior knowledge (e.g., from coring many lakes, we now have decent estimates of typical sediment accumulation rates, <a href="https://www.sciencedirect.com/science/article/abs/pii/S0277379112002132">Goring et al.&nbsp;2012</a>);</li>
<li>they can handle highly irregular probability distribution functions such as those for radiocarbon dates after calibration; and as a result</li>
<li>they generally do a better job of describing uncertainty than traditional age-depth models.</li>
</ol></li>
</ol>
</section>
</section>
<section id="part-2-exercises" class="level1">
<h1>Part 2: Exercises</h1>
<section id="exercise-1-calibration" class="level2">
<h2 class="anchored" data-anchor-id="exercise-1-calibration">Exercise 1: Calibration</h2>
<p>Here we’ll experiment with calibrating radiocarbon dates, using various calibration curves. The package <code>Bchron</code> makes calibrating dates to different curves easy for us.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Recall from the previous lab that you need to load packages with the <code>library()</code> function before you can access the functions provided by <code>Bchron</code>. Alternatively you can use the syntax <code>package::function()</code> to specify a function from a particular package. For example, <code>Bchron::BchronCalibrate()</code>.</p>
</div>
</div>
<p>First, we will check out different calibration curves of a single date using the example provided in the <code>Bchron</code> help. The function for calibrating radiocarbon dates in <code>Bchron</code> is <code>BchronCalibrate()</code>.</p>
<div class="callout-caution callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Calibration Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li><p>Using the help <code>?</code>, read the documentation of the <code>BchronCalibrate</code> function and run the first example provided. Copy and paste the code into your R script.</p></li>
<li><p>For three examples of radiocarbon age estimates (5000, 10000, 20000 years BP, each with a standard deviation of 100 years), calibrate each using the IntCal20 Northern Hemisphere curve.</p></li>
<li><p>Calculate the difference between the original <sup>14</sup>C age and the median calibrated age estimate.</p></li>
<li><p>For a radiocarbon age estimate of 10000 years BP with a standard deviation of 100 years, calibrate it to three different calibration curves. Try using both the Southern Hemisphere curve and the marine curves. Show all these variants in your R script. How much do these different calibration curves affect the resultant age estimates?</p></li>
<li><p>Describe in general terms the relationship between a radiocarbon age estimate and the true calibrated age estimate, i.e.&nbsp;are calibrated age estimates older or younger than the radiocarbon ages, and does this difference change over time?</p></li>
</ol>
<p>Show all work in your R script. For Q5, write your answer as a comment in the R script.</p>
</div>
</div>
</section>
<section id="exercise-2-classical-age-depth-models" class="level2">
<h2 class="anchored" data-anchor-id="exercise-2-classical-age-depth-models">Exercise 2: Classical age-depth models</h2>
<p>Here we’ll explore and compare the results from some classical models using the <code>clam</code> package. As noted above, <code>clam</code> is now out of date. However, it is useful to see how different classical models work, because they are simpler than Bayesian methods and were widely used and in the literature.</p>
<div class="callout-caution callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
CLAM Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li><p>We have posted a sample geochronology dataset (clam_runs/DevilsLakeAMS/DevilsLakeAMS.csv) from Devils Lake WI to give an example of the input directory structure and file formatting expected by clam.</p>
<ol type="i">
<li><p>Download the directory (clam_runs) to your current working directory (03-age-depth-modelling)</p></li>
<li><p>Clam expects input dates in a csv file in a sub-directory of the same name (e.g.&nbsp;clam_runs/MyCore1/MyCore1.csv)</p></li>
<li><p>Run clam usinng the function <code>clam()</code>. Use the help <code>?</code> to understand the arguments of the function</p></li>
</ol></li>
<li><p>Build the following age-depth models</p>
<ol type="i">
<li><p>linear interpolation (<code>type=1</code>)</p></li>
<li><p>linear regression (<code>type=2) [default is linear</code>]</p></li>
<li><p>3rd-order polynomial (<code>type=2, smooth=3</code>) [the smooth parameter sets the polynomial degree]</p></li>
<li><p>cubic spline (<code>type=3</code>)</p></li>
</ol></li>
</ol>
<p>Note that <code>clam</code> will save outputs to the directory clam_runs/DevilsLakeAMS/DevilsLakeAMS.csv, including the age-depth model plots you need for the homework below. (This is a bit clunky! Newer packages will generate the plots and data that can be stored as objects in R.)</p>
<ol start="3" type="1">
<li><p>Make a plot for each of the four classical age-depth models above. One axis should show depth and the other show age; make sure that the axes are labeled. Give each plot a title to indicate what kind of age-depth model was used.</p></li>
<li><p>Look at the Devils Lake pollen diagram in Neotoma Explorer and pick two notable vegetation events (e.g.&nbsp;end-Pleistocene <em>Picea</em> decline). Then, identify the depths of these events in Neotoma Explorer and use your output from clam to build a data matrix that reports the inferred mean age and 95% CI of these events in separate columns. Your table should have at least the columns: depth, min95%, max95%, best, accrate.</p></li>
<li><p>Using clam, construct a smooth spline (<code>type=3</code>) with the default smoothing parameter. Experiment with alternative values of the smooth parameter and pick 3-4 that show a range of model behavior. Make age-depth plots to show the various splines.</p></li>
</ol>
<p>Note that in clam you can also specify the position of ‘slumps’ (instantaneously deposited sediments, like a flood layer) and ‘hiatuses’ (gaps in the sediment record). Feel free to play with these options.</p>
</div>
</div>
</section>
<section id="exercise-3-bayesian-age-depth-models" class="level2">
<h2 class="anchored" data-anchor-id="exercise-3-bayesian-age-depth-models">Exercise 3: Bayesian age-depth models</h2>
<p>There are two equally advanced package for age-depth modelling in R: <code>rbacon</code> (usually called just bacon) and <code>Bchron</code>. We will be experimenting with <code>Bchron</code> as it is marginally more user friendly in R. Like clam, bacon requires a specific directory structure and column ordering of data, which is a bit clunky. Of course, software and packages are regularly updated. Things that were difficult or impossible last month may have changed by the next.</p>
<p>Bchron has a useful <a href="https://cran.r-project.org/web/packages/Bchron/vignettes/Bchron.html#calibrating-radiocarbon-dates">guide</a> with a working example using a dataset built-in with the package. Today we will use the Devil’s Lake data. Download the csv file: ‘devils_lake_bchron.csv’ to your working directory, and read it into R as a data.frame. Check out the structure of the data. Unlike <code>rbacon</code>, in <code>Bchron</code> the data do not need to be stored in a specific directory structure and the columns do not need to be in a specific order.</p>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Bchron Homework
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Download the Devil’s Lake data from the bchron_data directory.</strong> The data are the same, only the structure is slightly modified to work with <code>Bchron</code>. Using the <code>Bchron</code> guide:</p>
<ol type="1">
<li><p>Find the working example of how to run the age depth model and adapt the code to run the model on the Devil’s lake data</p></li>
<li><p>Include code to show the <code>plot</code> output from the age depth model of Devil’s Lake</p></li>
<li><p>Save the <code>summary</code> output as a named data object in your R Description</p></li>
<li><p>What similarities or differences do you notice in the BChron age-depth plot versus the plots generated by CLAM? The most notable difference is likely to be in the uncertainty envelopes. How are these different? As above, write your answer as a comment in the R script.</p></li>
</ol>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } 
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
    var links = window.document.querySelectorAll('a:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script>
</div> <!-- /content -->



</body></html>