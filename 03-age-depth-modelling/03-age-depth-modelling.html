<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.37">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2022-08-08">

<title>Lab 3: Age-depth modelling</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>


<script src="03-age-depth-modelling_files/libs/clipboard/clipboard.min.js"></script>
<script src="03-age-depth-modelling_files/libs/quarto-html/quarto.js"></script>
<script src="03-age-depth-modelling_files/libs/quarto-html/popper.min.js"></script>
<script src="03-age-depth-modelling_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="03-age-depth-modelling_files/libs/quarto-html/anchor.min.js"></script>
<link href="03-age-depth-modelling_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="03-age-depth-modelling_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="03-age-depth-modelling_files/libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="03-age-depth-modelling_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="03-age-depth-modelling_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="03-age-depth-modelling_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="03-age-depth-modelling_files/libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#before-the-lab" id="toc-before-the-lab" class="nav-link active" data-scroll-target="#before-the-lab">Before the lab</a></li>
  <li><a href="#part-1-background" id="toc-part-1-background" class="nav-link" data-scroll-target="#part-1-background">Part 1: Background</a>
  <ul class="collapse">
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#calibration-of-radiocarbon-dates" id="toc-calibration-of-radiocarbon-dates" class="nav-link" data-scroll-target="#calibration-of-radiocarbon-dates">Calibration of Radiocarbon Dates</a></li>
  <li><a href="#types-of-age-depth-models" id="toc-types-of-age-depth-models" class="nav-link" data-scroll-target="#types-of-age-depth-models">Types of Age-Depth Models</a></li>
  </ul></li>
  <li><a href="#part-2-exercises" id="toc-part-2-exercises" class="nav-link" data-scroll-target="#part-2-exercises">Part 2: Exercises</a>
  <ul class="collapse">
  <li><a href="#callibration" id="toc-callibration" class="nav-link" data-scroll-target="#callibration">Callibration</a></li>
  <li><a href="#classical-age-depth" id="toc-classical-age-depth" class="nav-link" data-scroll-target="#classical-age-depth">Classical age-depth</a></li>
  <li><a href="#exercise-3-bayesian-age-depth-modelling" id="toc-exercise-3-bayesian-age-depth-modelling" class="nav-link" data-scroll-target="#exercise-3-bayesian-age-depth-modelling">Exercise 3: Bayesian age-depth modelling</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Lab 3: Age-depth modelling</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 8, 2022</p>
    </div>
  </div>
    
  </div>
  

</header>

<section id="before-the-lab" class="level1">
<h1>Before the lab</h1>
<p>Using what you learned from the last lab:</p>
<ol type="1">
<li><p>create a directory for this lab called 03-age-depth-modelling and two sub-directories within it called ‘data’, and ‘outputs’</p></li>
<li><p>create an R project inside 03-age-depth-modelling, open a new R script, install the packages ‘clam’, and ‘Bchron’, and save your script</p></li>
</ol>
<p>Read these two papers:</p>
<ol type="1">
<li><p>Bronk Ramsey, C. (2008) Radiocarbon dating: Revolutions in understanding. Archaeometry 50:249-275. Read only to p.260. A good overview of radiocarbon fundamentals and interpretation for a general audience.</p></li>
<li><p>Blaauw, M. (2010) Methods and code for ‘classical’ age-modelling of radiocarbon sequences. Quaternary Geochronology 5:512-518. Good overview and code for ‘classic’ age-depth modeling: linear interpolation, regression, polynomial regression, splines, etc.</p></li>
</ol>
</section>
<section id="part-1-background" class="level1">
<h1>Part 1: Background</h1>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>A foundational difference between geology and ecology is that, for geologists, time is an unknown variable that must be estimated with uncertainty. In contrast, most ecologists can assume that the temporal coordinates of their observations are known precisely, with zero uncertainty. Fortunately, geochronologists have a wide variety of natural clocks, thanks to the constant decay rates of radioactive isotopes. Each isotope has a unique decay rate, and so each is appropriate for particular timescales.</p>
<p>For the last 50,000 years, radiocarbon (14C), with its half-life of 5730 years, is by far the most common form of radiometric dating. (Beyond 10 half-lives, so much of a radioactive substance has decayed away that it becomes immeasurable.) Radiocarbon is the mainstay of Quaternary dating and archaeology.</p>
<p>In Quaternary paleoecology, radiocarbon dating is expensive – a single sample typically costs $300 to $500 – so usually a given lake-sediment record will have only a scattering (ca. 5-30) of radiocarbon dates and other age controls. Other kinds of age controls include volcanic ash layers (tephras), 210Pb, optically stimulated luminescence (OSL) dates, historic events such as the rise in Ambrosia pollen abundances associated with EuroAmerican land clearance, etc.) An age model must be constructed to estimate the age of sediments not directly associated with an age control. In multi-site data syntheses, the number of age controls, their precision, and their likely accuracy are all fundamental indicators of data quality (e.g.&nbsp;<a href="https://www.sciencedirect.com/science/article/pii/S0277379111001193">Blois et al.&nbsp;2011</a>).</p>
<p>To estimate ages for depths lacking radiocarbon date, an age-depth model is required. Age-depth models are fitted to the available age controls (age estimates with uncertainty for individual depths) and provide estimates of age as a function of depth, for all depths and ages within the temporal bounds of the model.</p>
<p>Here we will gain practice in working with age-depth models of various kinds, using several standard R packages (clam, rbacon, and see also Bchron), and assessing their age estimates and uncertainty. We’ll begin with a bit of practice in calibrating radiocarbon years to calendar years and comparing the calibration estimates from different calibration curves.</p>
</section>
<section id="calibration-of-radiocarbon-dates" class="level2">
<h2 class="anchored" data-anchor-id="calibration-of-radiocarbon-dates">Calibration of Radiocarbon Dates</h2>
<p>A complication in radiocarbon dating is that the initial calculation of a radiocarbon age assumes, by convention, that the amount of radiocarbon in the atmosphere is constant over time. See (Bronk Ramsey 2008) for a good overview of 14C dating. This assumption is untrue, so all radiocarbon age estimates must be calibrated using a calibration curve that is based on compiling radiocarbon dates of materials that have precise independent age estimates (e.g.&nbsp;tree rings, corals). The IntCal series (IntCal04, IntCal09, IntCal13, IntCal20) is the community standard for calibrating radiocarbon dates to age estimates in calendar years. The conversion from radiocarbon to calendar years usually further increases the uncertainty of age estimates.</p>
<p>Yet another complication in radiocarbon dating is that different calibration curves need to be used for the Northern vs.&nbsp;Southern Hemisphere and for the atmosphere vs.&nbsp;oceans, due to different residence times of 14C in these different reservoirs. For example, atmospheric radiocarbon that diffuses into the surface oceans usually will reside for centuries before phytoplankton biologically fix it through photosynthesis, which will lead the marine 14C to be depleted (and ‘too old’) relative to atmospheric 14C. Use the wrong calibration curve and your age estimate will be inaccurate!</p>
</section>
<section id="types-of-age-depth-models" class="level2">
<h2 class="anchored" data-anchor-id="types-of-age-depth-models">Types of Age-Depth Models</h2>
<p>Different kinds of age-depth models exist, each with their own underlying assumptions and behavior. In the list below, #1-4 are classical or traditional forms of age-depth models, but Bayesian models (bacon, bchron) are now the norm. For learning purposes, we’ll begin with the classics.</p>
<ol type="1">
<li><p><strong>Linear interpolation</strong>, a.k.a. ‘connect the dots,’ in which straight lines are drawn between each depth-adjacent pair of age controls.</p></li>
<li><p><strong>Linear regression</strong> (y=b0 + b1x; y=time and x=depth; b0 and b1 are constants), in which a single straight line is fitted through the entire set of age controls. In ordinary linear regression (OLS), the chosen line will minimize the y-dimension distances of individual points to the line. Standard OLS assumes that all observations are normally distributed, which is a poor assumption for calibrated radiocarbon dates.</p></li>
<li><p><strong>Polynomials</strong>, also fitted to the entire set of age controls (y= b0 + b1x + b2x^2 + b3x^3 + …bnx^n) and are an extension of linear regression, with additional terms for x^2, x^3, etc. Some arbitrary maximum n is chosen, usually in the range of 3 to 5. Splines, which are a special kind of polynomial function that are locally fitted to subsets of the age controls, and then smoothly interpolate between points. (Several different formulas can be used to generate splines; common forms include cubic, smooth, monotonic, and LOWESS).</p></li>
<li><p><strong>Bayesian age models</strong> (e.g.&nbsp;bacon, bchron, oxcal, etc.). Bayesian models differ in detail, but all combine a statistical representation of prior knowledge with the new data (i.e.&nbsp;the age controls at a site) to build an age-depth model with posterior estimates of age for any given depth. Bayesian models are now widely used because 1) they allow the incorporation of prior knowledge (e.g., from coring many lakes, we now have decent estimates of typical sediment accumulation rates, (Goring et al.&nbsp;2012); 2) they can handle highly irregular probability distribution functions such as those for after-calibration radiocarbon dates; and as a result 3) they generally do a better job of describing uncertainty than traditional age-depth models.</p></li>
</ol>
</section>
</section>
<section id="part-2-exercises" class="level1">
<h1>Part 2: Exercises</h1>
<section id="callibration" class="level2">
<h2 class="anchored" data-anchor-id="callibration">Callibration</h2>
<p>Radiocarbon dates need to be calibrated to place them on the calendar year scale. Different calibration curves are used for the Northern and Southern Hemisphere, and sediment types. The package <code>Bchron</code> makes calibrating dates to different curves easy for us.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Recall from the previous lab that you need to load packages with the <code>library()</code> function before you can access the functions provided by <code>Bchron</code>. Alternatively you can use <code>package::function()</code> to specify a function from a particular package. For example, <code>Bchron::BchronCalibrate()</code></p>
</div>
</div>
<p>First, we will check out different calibration curves of a single date using the example provided in the <code>Bchron</code> help. The function for calibrating radiocarbon dates in <code>Bchron</code> is <code>BchronCalibrate()</code>.</p>
<div class="callout-caution callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Ecercise
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li><p>using the help <code>?</code>, read the documentation of the <code>BchronCalibrate</code> function and run the first example provided.</p>
<ul>
<li>You can copy and paste the code into your R script.</li>
</ul></li>
<li><p>run the same example using a different inputs for <code>calCurves =</code> argument. Try using both the Shouthern Hemisphere curve and the marine curves.</p></li>
</ol>
</div>
</div>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Homework
</div>
</div>
<div class="callout-body-container callout-body">
<p>Construct a table of a single date calibrated to three different curves specifying:</p>
<ul>
<li><p>the original radiocarbon age and standard deviation.</p></li>
<li><p>the calibrated age ranges from <code>summary()</code>.</p></li>
<li><p>the calibration curve used.</p></li>
</ul>
</div>
</div>
</section>
<section id="classical-age-depth" class="level2">
<h2 class="anchored" data-anchor-id="classical-age-depth">Classical age-depth</h2>
<p>‘Classical’ age-depth modelling was used prior to recent developments in advanced statistical methods for fitting age-depth models. We will explore and compare the results from some classical models using the <code>clam</code> package. The authors of the <code>clam</code> package have developed a more advanced package (<code>rbacon</code>, referred to as ‘bacon’) for age-depth modelling and <code>clam</code> is now out of date. However, it is useful to see how different classical models work as, prior to the development of Bayesian methods, they were used and are reported in the literature.</p>
<div class="callout-caution callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li><p>I have posted a sample geochronology dataset (clam_runs/DevilsLakeAMS/DevilsLakeAMS.csv) from Devils Lake WI to give an example of the input directory structure and file formatting expected by clam.</p>
<ol type="i">
<li><p>download the directory (clam_runs) to your current working directory (03-age-depth-modelling)</p></li>
<li><p>clam expects input dates in a csv file in a sub-directory of the same name (e.g.&nbsp;clam_runs/MyCore1/MyCore1.csv)</p></li>
<li><p>the function you need to run the model is <code>clam()</code>. Use the help <code>?</code> to understand the arguments of the function</p></li>
</ol></li>
<li><p>Build the following age-depth models</p>
<ol type="i">
<li><p>linear interpolation (type=1)</p></li>
<li><p>linear regression (type=2) [default is linear]</p></li>
<li><p>3rd-order polynomial (type=2, smooth=3) [the smooth parameter sets the polynomial degree]</p></li>
<li><p>cubic spline (type=3)</p></li>
</ol></li>
</ol>
</div>
</div>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Homework
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><p>Add the classical age-depth from clam to your homework. One axis should show depth and the other show age. Make sure each plot is titled so that I know which model is which.</p></li>
<li><p>Look at the Devils Lake pollen diagram in Neotoma Explorer and pick two notable vegetation events (e.g.&nbsp;end-Pleistocene Picea decline). Then, identify the depths of these events in Neotoma Explorer and use your output from clam to build a table that reports the inferred mean age and 95% CI of these events in separate columns. Your table will have at least XX columns: Depth, MeanAge_LinInterp, 95%CI_LinInterp, MeanAge_LinReg, 95%CI_LinReg, MeanAge_Poly, 95%CI_Poly, MeanAge_Spline, 95%CI_Spline.</p></li>
<li><p>Using clam, construct a smooth spline (type=“smooth”) with the default smoothing parameter</p></li>
<li><p>Experiment with alternative values of the smooth parameter and pick 3-4 that show a range of model behavior</p></li>
<li><p>Homework: As in 3., make age-depth plots to show the various splines. To the table created above, add columns that reports the mean age estimates and uncertainties. Note that in clam you can also specify the position of ‘slumps’ (instantaneously deposited sediments, like a flood layer) and ‘hiatuses’ (gaps in the sediment record). Feel free to play with these options.</p></li>
</ul>
</div>
</div>
</section>
<section id="exercise-3-bayesian-age-depth-modelling" class="level2">
<h2 class="anchored" data-anchor-id="exercise-3-bayesian-age-depth-modelling">Exercise 3: Bayesian age-depth modelling</h2>
<p>There are two equally advanced package for age-depth modelling in R: <code>rbacon</code> (usually called just bacon) and <code>Bchron</code>. We will be experimenting withe <code>Bchron</code> as it is marginally more user friendly in R. Bacon requires a specific directory structure and column ordering of data. Remember, software such as R and packages such as Bacon regularly update. Things that were difficult or impossible last month may have changed by the next.</p>
<p><a href="https://cran.r-project.org/web/packages/Bchron/vignettes/Bchron.html#calibrating-radiocarbon-dates">Bchron guide</a></p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } 
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>