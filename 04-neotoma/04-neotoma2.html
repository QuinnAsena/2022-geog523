<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.37">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2022-08-18">

<title>Lab 4: Direct Porting of Neotoma Data into R: APIs and neotoma</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="04-neotoma2_files/libs/clipboard/clipboard.min.js"></script>
<script src="04-neotoma2_files/libs/quarto-html/quarto.js"></script>
<script src="04-neotoma2_files/libs/quarto-html/popper.min.js"></script>
<script src="04-neotoma2_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="04-neotoma2_files/libs/quarto-html/anchor.min.js"></script>
<link href="04-neotoma2_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="04-neotoma2_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="04-neotoma2_files/libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="04-neotoma2_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="04-neotoma2_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="04-neotoma2_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="04-neotoma2_files/libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script src="04-neotoma2_files/libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<script src="04-neotoma2_files/libs/jquery-1.12.4/jquery.min.js"></script>
<link href="04-neotoma2_files/libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="04-neotoma2_files/libs/leaflet-1.3.1/leaflet.js"></script>
<link href="04-neotoma2_files/libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="04-neotoma2_files/libs/proj4-2.6.2/proj4.min.js"></script>
<script src="04-neotoma2_files/libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="04-neotoma2_files/libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="04-neotoma2_files/libs/leaflet-binding-2.1.1/leaflet.js"></script>
<script src="04-neotoma2_files/libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="04-neotoma2_files/libs/leaflet-providers-plugin-2.1.1/leaflet-providers-plugin.js"></script>
<link href="04-neotoma2_files/libs/leaflet-markercluster-1.0.5/MarkerCluster.css" rel="stylesheet">
<link href="04-neotoma2_files/libs/leaflet-markercluster-1.0.5/MarkerCluster.Default.css" rel="stylesheet">
<script src="04-neotoma2_files/libs/leaflet-markercluster-1.0.5/leaflet.markercluster.js"></script>
<script src="04-neotoma2_files/libs/leaflet-markercluster-1.0.5/leaflet.markercluster.freezable.js"></script>
<script src="04-neotoma2_files/libs/leaflet-markercluster-1.0.5/leaflet.markercluster.layersupport.js"></script>


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#before-the-lab" id="toc-before-the-lab" class="nav-link active" data-scroll-target="#before-the-lab">Before the lab</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#goals" id="toc-goals" class="nav-link" data-scroll-target="#goals">Goals</a></li>
  <li><a href="#resources" id="toc-resources" class="nav-link" data-scroll-target="#resources">Resources</a></li>
  </ul></li>
  <li><a href="#part-1-apis" id="toc-part-1-apis" class="nav-link" data-scroll-target="#part-1-apis">Part 1: APIs</a>
  <ul class="collapse">
  <li><a href="#apis" id="toc-apis" class="nav-link" data-scroll-target="#apis">APIs</a></li>
  </ul></li>
  <li><a href="#part-2-neotoma-workflow" id="toc-part-2-neotoma-workflow" class="nav-link" data-scroll-target="#part-2-neotoma-workflow">Part 2: Neotoma workflow</a>
  <ul class="collapse">
  <li><a href="#finding-sites-get_sites" id="toc-finding-sites-get_sites" class="nav-link" data-scroll-target="#finding-sites-get_sites">Finding sites: <code>get_sites()</code></a></li>
  <li><a href="#getting-datasets-get_datasets" id="toc-getting-datasets-get_datasets" class="nav-link" data-scroll-target="#getting-datasets-get_datasets">Getting datasets: <code>get_datasets()</code></a></li>
  <li><a href="#what-have-i-found-browse" id="toc-what-have-i-found-browse" class="nav-link" data-scroll-target="#what-have-i-found-browse">What have I found <code>browse</code></a></li>
  <li><a href="#want-to-read-more-get_publications" id="toc-want-to-read-more-get_publications" class="nav-link" data-scroll-target="#want-to-read-more-get_publications">Want to read more? <code>get_publications()</code></a></li>
  <li><a href="#downloading-data-get_downloads" id="toc-downloading-data-get_downloads" class="nav-link" data-scroll-target="#downloading-data-get_downloads">Downloading data <code>get_downloads()</code></a></li>
  <li><a href="#filtering-filter" id="toc-filtering-filter" class="nav-link" data-scroll-target="#filtering-filter">Filtering: <code>filter()</code></a></li>
  <li><a href="#returning-samples" id="toc-returning-samples" class="nav-link" data-scroll-target="#returning-samples">Returning samples</a></li>
  <li><a href="#extracting-taxa" id="toc-extracting-taxa" class="nav-link" data-scroll-target="#extracting-taxa">Extracting Taxa</a></li>
  <li><a href="#visualising-and-analyzing-results" id="toc-visualising-and-analyzing-results" class="nav-link" data-scroll-target="#visualising-and-analyzing-results">Visualising and analyzing results</a>
  <ul class="collapse">
  <li><a href="#visualising-and-analyzing-a-single-site" id="toc-visualising-and-analyzing-a-single-site" class="nav-link" data-scroll-target="#visualising-and-analyzing-a-single-site">Visualising and analyzing a single site</a></li>
  <li><a href="#visualising-and-analyzing-multiple-sites" id="toc-visualising-and-analyzing-multiple-sites" class="nav-link" data-scroll-target="#visualising-and-analyzing-multiple-sites">Visualising and analyzing multiple sites</a></li>
  </ul></li>
  <li><a href="#fun-with-for-loops" id="toc-fun-with-for-loops" class="nav-link" data-scroll-target="#fun-with-for-loops">Fun with For-Loops</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Lab 4: Direct Porting of Neotoma Data into R: APIs and <em>neotoma</em></h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 18, 2022</p>
    </div>
  </div>
    
  </div>
  

</header>

<section id="before-the-lab" class="level1">
<h1>Before the lab</h1>
<p><strong>Install packages:</strong></p>
<ul>
<li><code>neotoma2</code>, <code>analogue</code>, and <code>rworldmap</code>. <strong>??? all still necessary, rijoa replaced analogue?, rworldmap replaced by leaflet? ????</strong></li>
</ul>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note:
</div>
</div>
<div class="callout-body-container callout-body">
<p>To download the latest version of <code>neotoma2</code> you will need to download it from the source on GitHub.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"devtools"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">'NeotomaDB/neotoma2'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p><strong>Read:</strong></p>
<p>Goring, S., Dawson, A., Simpson, G., Ram, K., Graham, R. W., Grimm, E. C., and Williams, J. W. (2015) neotoma: A Programmatic Interface to the Neotoma Paleoecological Database. Open Quaternary 1:1-17.</p>
</section>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>This series of exercises is designed to give you hands-on practice in using APIs and the <code>neotoma2</code> R package (Goring et al, 2015), both for practical reasons and for insights into how open-data systems work. <code>neotoma2</code>’s primary purpose is to pass data from the Neotoma Paleoecology Database (Neotoma DB) into the R environment. Neotoma relies on Application Programming Interfaces (<a href="https://en.wikipedia.org/wiki/API">APIs</a>) to communicate with the Neotoma Paleoecology Database, so we’ll begin with an introduction to APIs.</p>
<p>Note that the R components of this exercise are adapted from materials originally developed by Simon Goring, Jack Williams, and others for Neotoma training workshops at PalEON and elsewhere (e.g.&nbsp;<a href="https://open.neotomadb.org/EPD_binder/simple_workflow.html">HTML</a> and GitHub) and are reproduced here under the <a href="https://opensource.org/licenses/MIT">MIT</a> License.</p>
<section id="goals" class="level2">
<h2 class="anchored" data-anchor-id="goals">Goals</h2>
<ul>
<li><p>Understand the flow of data through the Neotoma Paleoecology Database package, APIs, and neotoma package.</p></li>
<li><p>Learn how to use the neotoma R package and key functions (e.g.&nbsp;<code>get_sites()</code>, <code>get_datasets()</code>, <code>get_downloads()</code>)</p></li>
<li><p>Learn and develop code for single-site and multi-site data visualizations.</p></li>
<li><p>Learn to prepare Neotoma data for passing to standard software such as analogue</p></li>
</ul>
</section>
<section id="resources" class="level2">
<h2 class="anchored" data-anchor-id="resources">Resources</h2>
<ul>
<li><p><a href="https://github.com/NeotomaDB">GitHub</a> repository for the <code>neotoma2</code> R package:</p></li>
<li><p><a href="https://neotoma-manual.readthedocs.io/en/latest/">neotoma2 manual</a></p></li>
</ul>
</section>
</section>
<section id="part-1-apis" class="level1">
<h1>Part 1: APIs</h1>
<section id="apis" class="level2">
<h2 class="anchored" data-anchor-id="apis">APIs</h2>
<p>The Neotoma Paleoecology Database is a relational database, hosted on servers at <a href="https://sites.psu.edu/environmentalinformatics/">Penn State’s Center for Environmental Informatics</a>. For security reasons, direct access to these servers is quite limited, and available only to a few Neotoma and CEI programmers.</p>
<p><strong>APIs</strong> offer public access points into Neotoma that anyone can use. Each API is basically a function: you provide the API with a set of operational parameters, and it returns a set of data or metadata. Each API hence is designed to support one particular task or set of tasks; it offers a narrow window into the larger Neotoma DB. <a href="https://en.wikipedia.org/wiki/Representational_state_transfer">REST-ful APIs</a> follow a particular set of standards that allow them to be read by web browsers (i.e.&nbsp;within the HTTP protocol) and return data objects, typically in HTML, XML, JSON or other human- &amp; machine-readable formats</p>
<p>The <a href="https://api.neotomadb.org/api-docs/"><strong>Neotoma APIs</strong></a> provide a series of functions for retrieving different kinds of data from Neotoma DB. Data objects are returned in <a href="https://en.wikipedia.org/wiki/JSON">JSON</a> format. For this exercise, we strongly recommend adding an extension to your browser that formats the JSON output to make it easier to read, such as <a href="https://addons.mozilla.org/en-US/firefox/addon/jsonview/">JSONView</a>.</p>
<p><strong>The APIs for Neotoma are in transition right now, with version 1.0 the working version and versions 1.5 and 2.0 at the beta stage. The V1.5 and 2.0 APIs can be found here: https://api.neotomadb.org/api-docs/</strong></p>
<p><strong>Look through the lists of different APIs and find the one labled GET /v2.0/data/sites/{siteid}. Then, click on the Try It Out button at right, enter 666 into the site identifier box, and click Execute.</strong></p>
<p><strong>Then scroll down. You you should see some example code in curl format (ignore this) and as a URL. If you scroll down further, you’ll see the actual data return, in JSON format. JSON is a structured data format designed to be both human-readable and machine-readable. It looks like a nested series of lists</strong></p>
<p><strong>Let’s also try a V1.0 API. Put this right in the URL box in your browser:</strong></p>
<p>https://api.neotomadb.org/v1/data/sites?sitename=<em>devil</em></p>
<p><strong>This should open a new web page in your browser with a returned JSON object. For this search, the JSON object should include 16 or more sites with the name ‘devil’ in them (note the use of asterisks as wildcards), including Devil’s Lake, WI. The opening line success = 1 means that the API ran successfully.</strong></p>
<p><strong>Note that it is possible for an API to run successfully but return no data! For example, try:</strong></p>
<p>api.neotomadb.org/v1/data/sites?sitename=devil</p>
<p><strong>Here, success = 1, but data=[], i.e.&nbsp;the API successfully reported back to you that no sites in Neotoma have the exact name of ‘devil’.</strong></p>
<p><strong>OK, now your turn:</strong> <strong>Exercise Question 1 Use the sites API to retrieve site data for sites of interest. The sites API has a few different parameters, so try out options. In your homework exercise, provide at least two sites API calls with a comment line.</strong></p>
</section>
</section>
<section id="part-2-neotoma-workflow" class="level1">
<h1>Part 2: Neotoma workflow</h1>
<p>The <code>neotoma2</code> package provides a series of functions inside of R, each one of which calls one or more APIs. neotoma was primarily written by Simon Goring, with support from NSF-Geoinformatics and the ROpenSci project.</p>
<p><strong>The structure of the Neotoma data model, as expressed through the API is roughly: “counts of a fossil taxa within download, download within dataset, dataset within site”. So a dataset contains information about a particular dataset from a given site. A site may have one or several associated datasets.</strong></p>
<p>The neotoma data structure is as follows (take note of plural/singular):</p>
<ul>
<li><p>sites: multiple locations (e.g., several lakes)</p></li>
<li><p>site: a single location (e.g., a single lake)</p></li>
<li><p>collection units: one or more sediment core samples from a site</p></li>
<li><p>collection unit: a simgle core sample</p></li>
<li><p>datasets: the number of datasets from a single collection unit (e.g., pollen is one dataset, diatoms may be another)</p></li>
<li><p>dataset: an individual record (e.g., only the pollen data from a core)</p></li>
<li><p>chronologies: age-depth models associated with a single core (there may be more than one chronology per core)</p></li>
<li><p>chronology: a single chronology associated with a core sample</p></li>
</ul>
<div id="fig-neostructure" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="AMQUA_binder-main/images/neotomaUML_as.svg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure 1: <code>neotoma2</code> structure and associated functions</figcaption><p></p>
</figure>
</div>
<p>How the above points relate to eachother is illustrated in (<a href="#fig-neostructure">Figure&nbsp;1</a>). (<a href="#fig-neostructure">Figure&nbsp;1</a>) is a handy reference for what functions apply to different parts of the workflow. Let’s begin by loading the neotoma package into RStudio.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(neotoma2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="finding-sites-get_sites" class="level2">
<h2 class="anchored" data-anchor-id="finding-sites-get_sites">Finding sites: <code>get_sites()</code></h2>
<p>We’ll start with the function <code>get_sites()</code>. <code>get_sites()</code> returns a <code>sites</code> object with metadata about sites. You can use this to find the spatial coverage of data in a region (using <code>get_sites()</code> with a bounding box), or to get explicit site information easily from more complex data objects. Use <code>?get_sites</code> to see all the options available. <code>get_site()</code> is essentially an R wrapper for the API sites and has very similar functionality. You can easily search by site name, for example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>samwell_site <span class="ot">&lt;-</span> <span class="fu">get_sites</span>(<span class="at">sitename =</span> <span class="st">'Samwell%'</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(samwell_site)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>get_sites()</code> can return one site (as above) or many, e.g.:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>devil_sites <span class="ot">&lt;-</span> <span class="fu">get_sites</span>(<span class="at">sitename =</span> <span class="st">'devil%'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>get_sites()</code> (and most <code>neotoma2</code> functions) returns an data object of class <code>site</code>, this also allows us to use some of the other <code>neotoma2</code> functions more easily. In RStudio, use the Environment panel in upper right to explore the contents of <code>samwell_site</code>.</p>
<div class="callout-caution callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Exercise Question X
</div>
</div>
<div class="callout-body-container callout-body">
<p>How many sites have the name ‘clear’ in them? Show both your code and provide the total count.</p>
</div>
</div>
<p>You can also search by lat/lon bounding box. This one roughly corresponds to Florida. <strong>??? Need to update bounding box to sf/json???</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>FL_sites <span class="ot">&lt;-</span> <span class="fu">get_sites</span>(<span class="at">loc =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">88</span>, <span class="sc">-</span><span class="dv">79</span>, <span class="dv">25</span>, <span class="dv">30</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>_<strong>??? Geopolitical unites not working for me in neotoma2 ???</strong> <strong>You can also search by geopolitical name or geopolitical IDs (gpid) stored in Neotoma. For a list of names and gpids, use the get_table(table.name = “GeoPoliticalUnits”) command. This command works either with an explicit numeric ID, or with a text string:</strong></p>
<p><strong>Example: get all sites in New Mexico (gpid=7956)</strong></p>
<p><strong>NM_sites &lt;- get_site(gpid = 7956)</strong></p>
<p><strong>get all sites in Wisconsin</strong></p>
<p><strong>`WI_sites &lt;- get_site(gpid = “Wisconsin”)``</strong></p>
<p><strong>Exercise Question 3 Which state has more sites, Minnesota or Wisconsin? How many of each? Provide both code and answer.</strong></p>
</section>
<section id="getting-datasets-get_datasets" class="level2">
<h2 class="anchored" data-anchor-id="getting-datasets-get_datasets">Getting datasets: <code>get_datasets()</code></h2>
<p>To return the metadata on what datasets a collectionunit has, we use the <code>get_datasets()</code> function. <code>get_datasets()</code> receives as inputs vectors of site names, vectors of site IDs, or data objects of class site (i.e.&nbsp;output from <code>get_site()</code>!). For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We can pass output from get_site to get_datasets:</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>samwell_datasets <span class="ot">&lt;-</span> <span class="fu">get_datasets</span>(samwell_site)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(samwell_datasets)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Even if get_sites returns multiple sites:</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>devil.meta.dataset  <span class="ot">&lt;-</span> <span class="fu">get_datasets</span>(devil_sites)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Let’s look at the dataset metadata:</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>devil.meta.dataset</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout-caution callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Exercise Question X
</div>
</div>
<div class="callout-body-container callout-body">
<p>How many different kinds of datasets are available at Devil’s Lake, WI? Show both code and answer. Ensure that your code just retrieves datasets for just this single site.</p>
</div>
</div>
</section>
<section id="what-have-i-found-browse" class="level2">
<h2 class="anchored" data-anchor-id="what-have-i-found-browse">What have I found <code>browse</code></h2>
<p><strong>Sometimes, it’s helpful to quickly spot-check your results using Neotoma Explorer and its quick-look visualizations. You can pass your results back to Explorer using the browse command. browse will accept a numberic value (a single Dataset ID) and data objects of type ‘dataset’, ‘dataset_list’, ‘download’, or ‘download_list’</strong></p>
<p><strong>For example: browse(samwell_datasets)</strong></p>
<p><strong>Note that browse returns a local result of null to R (which is normal) and then calls a new browser window, showing the Samwell datasets in Neotoma Explorer.</strong></p>
<p><strong>REPLACE BROWSE WITH <code>plotLeaflet()</code>?</strong></p>
<p>Sometimes, it’s helpful to quickly spot-check your results using Neotoma Explorer and its quick-look visualizations. You can easily visualise your results using the <code>plotLeaflet()</code> function. Mapping results can be especially handy if you have returned a site in an unexpected location when searching for sites by a partial name match. Have a look at the geographical locations of sites returned with the name ‘Devil’.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotLeaflet</span>(devil_sites)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="htmlwidget-3b39f3a1288788262e34" style="width:100%;height:464px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-3b39f3a1288788262e34">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addProviderTiles","args":["Stamen.TerrainBackground",null,null,{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addCircleMarkers","args":[[48.022914,43.4159,48.081514,48.014636,48.022636,43.024608,45.814184,44.98,56.16667,48.0189,35.69722,42.316004,44.034428,48.056368],[-98.962028,-89.73334,-98.934766,-98.890688,-98.988878,-77.573886,-93.334446,-123.995754,-133.5,-98.89294,-115.45222,-120.960152,-121.761974,-99.11855],10,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":true,"riseOffset":250,"stroke":true,"color":"#03F","weight":5,"opacity.1":0.5,"fill":true,"fillColor":"#03F","fillOpacity":0.2},{"showCoverageOnHover":true,"zoomToBoundsOnClick":true,"spiderfyOnMaxZoom":true,"removeOutsideVisibleBounds":true,"spiderLegPolylineOptions":{"weight":1.5,"color":"#222","opacity":0.5},"freezeAtZoom":false},null,["<b>Devils Lake, Main Bay<\/b><br><b>Description:<\/b> Very large closed basin, ice-thrust lake, which lies in a preglacial valley. Water level has varied dramatically during the historical period.<br><a href=http://apps.neotomadb.org/explorer/?siteids=665>Explorer Link<\/a>","<b>Devils Lake<\/b><br><b>Description:<\/b> Lake is located in a pre-glacial gorge of the Wisconsin river cut through the Baraboo Hills, a bedrock high. The valley is dammed at both ends by terminal moraines deposited by the Green Bay lobe, which flowed around the Baraboo Hills. Lake is fed by groundwater. Surrounding vegetation: white-black-bur oak.<br><a href=http://apps.neotomadb.org/explorer/?siteids=666>Explorer Link<\/a>","<b>Devils Lake, Creel Bay<\/b><br><b>Description:<\/b> Very large closed basin, ice-thrust lake, which lies in a preglacial valley. Water level has varied dramatically during the historical period. Creel Bay has a maximum depth of about 15 m.<br><a href=http://apps.neotomadb.org/explorer/?siteids=9717>Explorer Link<\/a>","<b>Devils Lake, Mission Bay<\/b><br><b>Description:<\/b> Very large closed basin, ice-thrust lake, which lies in a preglacial valley. Water level has varied dramatically during the historical period. MIssion Bay has a maximum depth of about 13 m.<br><a href=http://apps.neotomadb.org/explorer/?siteids=9732>Explorer Link<\/a>","<b>Devils Lake<\/b><br><b>Description:<\/b> Very large closed basin, ice-thrust lake, which lies in a preglacial valley. Water level has varied dramatically during the historical period. MIssion Bay has a maximum depth of about 13 m.<br><a href=http://apps.neotomadb.org/explorer/?siteids=9961>Explorer Link<\/a>","<b>Devil's Bathtub<\/b><br><b>Description:<\/b> Kettle pond located in the till plains of the Erie-Ontario lowland. Surrounding vegetation: Quercus and Acer saccharum, with nearby plantations of Pinus resinosa.<br><a href=http://apps.neotomadb.org/explorer/?siteids=10280>Explorer Link<\/a>","<b>Devils Lake<\/b><br><b>Description:<\/b> NA<br><a href=http://apps.neotomadb.org/explorer/?siteids=11726>Explorer Link<\/a>","<b>Devil's Lake<\/b><br><b>Description:<\/b> Devils Lake is an eutrophic lake located in Lincoln County on the central Oregon coast. The lake was formed by natural accumulation of. beachs and impounding water at the outlet of the D River.<br><a href=http://apps.neotomadb.org/explorer/?siteids=14224>Explorer Link<\/a>","<b>Devil's Canopy Cave [AKPET221]<\/b><br><b>Description:<\/b> Silty deposit in a cave on Prince of Wales Island, Petersburg quadrangle, southeastern Alaska. <br><a href=http://apps.neotomadb.org/explorer/?siteids=18518>Explorer Link<\/a>","<b>Devils Lake<\/b><br><b>Description:<\/b> NA<br><a href=http://apps.neotomadb.org/explorer/?siteids=23349>Explorer Link<\/a>","<b>Devil Peak Fauna<\/b><br><b>Description:<\/b> NA<br><a href=http://apps.neotomadb.org/explorer/?siteids=23437>Explorer Link<\/a>","<b>Devil Lake<\/b><br><b>Description:<\/b> Juniperus occidentalis, Pinus ponderosa, Artemisia tridentata, Poaceae<br><a href=http://apps.neotomadb.org/explorer/?siteids=27576>Explorer Link<\/a>","<b>Devils Lake<\/b><br><b>Description:<\/b> Abies lasiocarpa, Pinus contorta<br><a href=http://apps.neotomadb.org/explorer/?siteids=27605>Explorer Link<\/a>","<b>Devils<\/b><br><b>Description:<\/b> NA<br><a href=http://apps.neotomadb.org/explorer/?siteids=28909>Explorer Link<\/a>"],null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[35.69722,56.16667],"lng":[-133.5,-77.573886]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="want-to-read-more-get_publications" class="level2">
<h2 class="anchored" data-anchor-id="want-to-read-more-get_publications">Want to read more? <code>get_publications()</code></h2>
<p>You can use <code>get_publications()</code> to get information on publications associated with sites. Pass in the publication IDs or a dataset object, e.g.:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>samwell_pubs <span class="ot">&lt;-</span> <span class="fu">get_publications</span>(samwell_datasets)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Error in switch(use, dev = "https://api-dev.neotomadb.org/v2.0/", neotoma = "https://api.neotomadb.org/v2.0/",  : </span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># EXPR must be a length 1 vector</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="downloading-data-get_downloads" class="level2">
<h2 class="anchored" data-anchor-id="downloading-data-get_downloads">Downloading data <code>get_downloads()</code></h2>
<p><strong><code>get_downloads()</code> returns a list of download objects, one for each retrieved dataset.</strong> Note that <code>get_downloads()</code> returns the actual data associated with each dataset, rather than a list of the available datasets, as in <code>get_datasets()</code> above. <code>get_downloads()</code> will accept an object of <code>class</code> dataset (e.g., <code>samwell_dataset</code>) or of <code>class</code> site (e.g., <code>samwell_site</code>). If the latter, it will automatically query for the datasets associated in each site. For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>samwell_datasets_downloads <span class="ot">&lt;-</span> <span class="fu">get_downloads</span>(samwell_datasets)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>samwell_site_downloads <span class="ot">&lt;-</span> <span class="fu">get_downloads</span>(samwell_site)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(samwell_datasets_downloads)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(samwell_site_downloads)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that by default, <code>get_downloads()</code> produces a number of messages. These can be suppressed with the argument <code>verbose = FALSE</code> in the function call (<code>samwell_site_downloads &lt;- get_downloads(samwell_site, verbose = FALSE</code>).</p>
<p><strong>Note that not all of the datasets can be downloaded directly to a <code>download</code> object. This is because geochronological datasets have a different data structure than other data, requiring different fields, and as such, they are obtained using <em>???<code>chronologies()</code> chronologies only works on a download oblect now? Not a site object? ???</em>:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>samwell_geochron <span class="ot">&lt;-</span> <span class="fu">chronologies</span>(samwell_site_downloads)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(samwell_geochron)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="filtering-filter" class="level2">
<h2 class="anchored" data-anchor-id="filtering-filter">Filtering: <code>filter()</code></h2>
<p><strong>??? Should Filtering come before downloading???</strong></p>
<p>Collection units contain datasets (<a href="#fig-neostructure">Figure&nbsp;1</a>). We can use the <code>datasets()</code> function on a site (or sites) to return details on what records they contain:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">datasets</span>(samwell_datasets)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> datasetid database      datasettype age_range_old age_range_young
     14262  FAUNMAP vertebrate fauna       18306.2               0
                                                                                                                           notes
 Pleistocene levels are locality V99822 and Holocene levels are locality V99785 in the UCMP. Depths are given in cm below datum.</code></pre>
</div>
</div>
<p>Notice that there are seven datasets associated with the <code>samwell_datasets</code> object, each one with a <code>datasetid</code>. Note that at this point we have not downloaded any data, we are browsing the metadata associated with the site. Downloading data can have a lot of overhead (e.g., download time and API requests), so we try filter results to what we need <em>before</em> downloading the data. For example, if we want to filter the <code>samwell_datasets</code> object for vertebrate fauna we can use:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>samwell_datasets_vf <span class="ot">&lt;-</span> samwell_datasets <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  neotoma2<span class="sc">::</span><span class="fu">filter</span>(datasettype <span class="sc">==</span> <span class="st">"vertebrate fauna"</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(age_range_young))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, we can use <code>get_downloads()</code> to download a single dataset, rather that <em>all</em> the data as we did above. Let’s download only the vertebrate datasets for Samwell Cave Popcorn Dome (dataset 14262):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>samwell_pd <span class="ot">&lt;-</span> <span class="fu">get_downloads</span>(<span class="dv">14262</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="returning-samples" class="level2">
<h2 class="anchored" data-anchor-id="returning-samples">Returning samples</h2>
<p>Let’s examine the available data in this download:</p>
</section>
<section id="extracting-taxa" class="level2">
<h2 class="anchored" data-anchor-id="extracting-taxa">Extracting Taxa</h2>
<p><strong>??? Seems to have changed a lot since <code>neotoma</code> no longer <code>compile_taxa()</code>???</strong></p>
</section>
<section id="visualising-and-analyzing-results" class="level2">
<h2 class="anchored" data-anchor-id="visualising-and-analyzing-results">Visualising and analyzing results</h2>
<p><strong>???Should this still follow <code>analogue</code> like the older resource or <code>rijoa</code> like https://open.neotomadb.org/EPD_binder/simple_workflow.html#Searching_for_datasets: ???</strong></p>
<section id="visualising-and-analyzing-a-single-site" class="level3">
<h3 class="anchored" data-anchor-id="visualising-and-analyzing-a-single-site">Visualising and analyzing a single site</h3>
</section>
<section id="visualising-and-analyzing-multiple-sites" class="level3">
<h3 class="anchored" data-anchor-id="visualising-and-analyzing-multiple-sites">Visualising and analyzing multiple sites</h3>
</section>
</section>
<section id="fun-with-for-loops" class="level2">
<h2 class="anchored" data-anchor-id="fun-with-for-loops">Fun with For-Loops</h2>
<p><strong>??? Section still necessary???</strong></p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } 
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
    var links = window.document.querySelectorAll('a:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script>
</div> <!-- /content -->



</body></html>